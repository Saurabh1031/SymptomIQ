{"version":3,"file":"channel.js","mappings":"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","sources":["webpack://@bugfender/sdk/webpack/universalModuleDefinition","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/broadcast-channel.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/index.es5.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/index.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/leader-election.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/method-chooser.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/methods/indexed-db.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/methods/localstorage.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/methods/native.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/methods/simulate.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/options.js","webpack://@bugfender/sdk/./node_modules/broadcast-channel/dist/lib/util.js","webpack://@bugfender/sdk/./node_modules/oblivious-set/dist/es/index.js","webpack://@bugfender/sdk/./node_modules/process/browser.js","webpack://@bugfender/sdk/./src/channel.ts","webpack://@bugfender/sdk/./node_modules/unload/dist/es/index.js","webpack://@bugfender/sdk/./node_modules/unload/dist/es/node.js","webpack://@bugfender/sdk/./node_modules/unload/dist/es/browser.js","webpack://@bugfender/sdk/./node_modules/@babel/runtime/helpers/typeof.js","webpack://@bugfender/sdk/webpack/bootstrap","webpack://@bugfender/sdk/webpack/runtime/define property getters","webpack://@bugfender/sdk/webpack/runtime/hasOwnProperty shorthand","webpack://@bugfender/sdk/webpack/runtime/make namespace object","webpack://@bugfender/sdk/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@bugfender/sdk\"] = factory();\n\telse\n\t\troot[\"@bugfender/sdk\"] = factory();\n})(self, () => {\nreturn ","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.OPEN_BROADCAST_CHANNELS = exports.BroadcastChannel = void 0;\nexports.clearNodeFolder = clearNodeFolder;\nexports.enforceOptions = enforceOptions;\nvar _util = require(\"./util.js\");\nvar _methodChooser = require(\"./method-chooser.js\");\nvar _options = require(\"./options.js\");\n/**\n * Contains all open channels,\n * used in tests to ensure everything is closed.\n */\nvar OPEN_BROADCAST_CHANNELS = new Set();\nexports.OPEN_BROADCAST_CHANNELS = OPEN_BROADCAST_CHANNELS;\nvar lastId = 0;\nvar BroadcastChannel = function BroadcastChannel(name, options) {\n  // identifier of the channel to debug stuff\n  this.id = lastId++;\n  OPEN_BROADCAST_CHANNELS.add(this);\n  this.name = name;\n  if (ENFORCED_OPTIONS) {\n    options = ENFORCED_OPTIONS;\n  }\n  this.options = (0, _options.fillOptionsWithDefaults)(options);\n  this.method = (0, _methodChooser.chooseMethod)(this.options);\n\n  // isListening\n  this._iL = false;\n\n  /**\n   * _onMessageListener\n   * setting onmessage twice,\n   * will overwrite the first listener\n   */\n  this._onML = null;\n\n  /**\n   * _addEventListeners\n   */\n  this._addEL = {\n    message: [],\n    internal: []\n  };\n\n  /**\n   * Unsent message promises\n   * where the sending is still in progress\n   * @type {Set<Promise>}\n   */\n  this._uMP = new Set();\n\n  /**\n   * _beforeClose\n   * array of promises that will be awaited\n   * before the channel is closed\n   */\n  this._befC = [];\n\n  /**\n   * _preparePromise\n   */\n  this._prepP = null;\n  _prepareChannel(this);\n};\n\n// STATICS\n\n/**\n * used to identify if someone overwrites\n * window.BroadcastChannel with this\n * See methods/native.js\n */\nexports.BroadcastChannel = BroadcastChannel;\nBroadcastChannel._pubkey = true;\n\n/**\n * clears the tmp-folder if is node\n * @return {Promise<boolean>} true if has run, false if not node\n */\nfunction clearNodeFolder(options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n  var method = (0, _methodChooser.chooseMethod)(options);\n  if (method.type === 'node') {\n    return method.clearNodeFolder().then(function () {\n      return true;\n    });\n  } else {\n    return _util.PROMISE_RESOLVED_FALSE;\n  }\n}\n\n/**\n * if set, this method is enforced,\n * no mather what the options are\n */\nvar ENFORCED_OPTIONS;\nfunction enforceOptions(options) {\n  ENFORCED_OPTIONS = options;\n}\n\n// PROTOTYPE\nBroadcastChannel.prototype = {\n  postMessage: function postMessage(msg) {\n    if (this.closed) {\n      throw new Error('BroadcastChannel.postMessage(): ' + 'Cannot post message after channel has closed ' +\n      /**\n       * In the past when this error appeared, it was really hard to debug.\n       * So now we log the msg together with the error so it at least\n       * gives some clue about where in your application this happens.\n       */\n      JSON.stringify(msg));\n    }\n    return _post(this, 'message', msg);\n  },\n  postInternal: function postInternal(msg) {\n    return _post(this, 'internal', msg);\n  },\n  set onmessage(fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n    _removeListenerObject(this, 'message', this._onML);\n    if (fn && typeof fn === 'function') {\n      this._onML = listenObj;\n      _addListenerObject(this, 'message', listenObj);\n    } else {\n      this._onML = null;\n    }\n  },\n  addEventListener: function addEventListener(type, fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n    _addListenerObject(this, type, listenObj);\n  },\n  removeEventListener: function removeEventListener(type, fn) {\n    var obj = this._addEL[type].find(function (obj) {\n      return obj.fn === fn;\n    });\n    _removeListenerObject(this, type, obj);\n  },\n  close: function close() {\n    var _this = this;\n    if (this.closed) {\n      return;\n    }\n    OPEN_BROADCAST_CHANNELS[\"delete\"](this);\n    this.closed = true;\n    var awaitPrepare = this._prepP ? this._prepP : _util.PROMISE_RESOLVED_VOID;\n    this._onML = null;\n    this._addEL.message = [];\n    return awaitPrepare\n    // wait until all current sending are processed\n    .then(function () {\n      return Promise.all(Array.from(_this._uMP));\n    })\n    // run before-close hooks\n    .then(function () {\n      return Promise.all(_this._befC.map(function (fn) {\n        return fn();\n      }));\n    })\n    // close the channel\n    .then(function () {\n      return _this.method.close(_this._state);\n    });\n  },\n  get type() {\n    return this.method.type;\n  },\n  get isClosed() {\n    return this.closed;\n  }\n};\n\n/**\n * Post a message over the channel\n * @returns {Promise} that resolved when the message sending is done\n */\nfunction _post(broadcastChannel, type, msg) {\n  var time = broadcastChannel.method.microSeconds();\n  var msgObj = {\n    time: time,\n    type: type,\n    data: msg\n  };\n  var awaitPrepare = broadcastChannel._prepP ? broadcastChannel._prepP : _util.PROMISE_RESOLVED_VOID;\n  return awaitPrepare.then(function () {\n    var sendPromise = broadcastChannel.method.postMessage(broadcastChannel._state, msgObj);\n\n    // add/remove to unsent messages list\n    broadcastChannel._uMP.add(sendPromise);\n    sendPromise[\"catch\"]().then(function () {\n      return broadcastChannel._uMP[\"delete\"](sendPromise);\n    });\n    return sendPromise;\n  });\n}\nfunction _prepareChannel(channel) {\n  var maybePromise = channel.method.create(channel.name, channel.options);\n  if ((0, _util.isPromise)(maybePromise)) {\n    channel._prepP = maybePromise;\n    maybePromise.then(function (s) {\n      // used in tests to simulate slow runtime\n      /*if (channel.options.prepareDelay) {\n           await new Promise(res => setTimeout(res, this.options.prepareDelay));\n      }*/\n      channel._state = s;\n    });\n  } else {\n    channel._state = maybePromise;\n  }\n}\nfunction _hasMessageListeners(channel) {\n  if (channel._addEL.message.length > 0) return true;\n  if (channel._addEL.internal.length > 0) return true;\n  return false;\n}\nfunction _addListenerObject(channel, type, obj) {\n  channel._addEL[type].push(obj);\n  _startListening(channel);\n}\nfunction _removeListenerObject(channel, type, obj) {\n  channel._addEL[type] = channel._addEL[type].filter(function (o) {\n    return o !== obj;\n  });\n  _stopListening(channel);\n}\nfunction _startListening(channel) {\n  if (!channel._iL && _hasMessageListeners(channel)) {\n    // someone is listening, start subscribing\n\n    var listenerFn = function listenerFn(msgObj) {\n      channel._addEL[msgObj.type].forEach(function (listenerObject) {\n        /**\n         * Getting the current time in JavaScript has no good precision.\n         * So instead of only listening to events that happened 'after' the listener\n         * was added, we also listen to events that happened 100ms before it.\n         * This ensures that when another process, like a WebWorker, sends events\n         * we do not miss them out because their timestamp is a bit off compared to the main process.\n         * Not doing this would make messages missing when we send data directly after subscribing and awaiting a response.\n         * @link https://johnresig.com/blog/accuracy-of-javascript-time/\n         */\n        var hundredMsInMicro = 100 * 1000;\n        var minMessageTime = listenerObject.time - hundredMsInMicro;\n        if (msgObj.time >= minMessageTime) {\n          listenerObject.fn(msgObj.data);\n        }\n      });\n    };\n    var time = channel.method.microSeconds();\n    if (channel._prepP) {\n      channel._prepP.then(function () {\n        channel._iL = true;\n        channel.method.onMessage(channel._state, listenerFn, time);\n      });\n    } else {\n      channel._iL = true;\n      channel.method.onMessage(channel._state, listenerFn, time);\n    }\n  }\n}\nfunction _stopListening(channel) {\n  if (channel._iL && !_hasMessageListeners(channel)) {\n    // no one is listening, stop subscribing\n    channel._iL = false;\n    var time = channel.method.microSeconds();\n    channel.method.onMessage(channel._state, null, time);\n  }\n}","\"use strict\";\n\nvar _index = require(\"./index.js\");\n/**\n * because babel can only export on default-attribute,\n * we use this for the non-module-build\n * this ensures that users do not have to use\n * var BroadcastChannel = require('broadcast-channel').default;\n * but\n * var BroadcastChannel = require('broadcast-channel');\n */\n\nmodule.exports = {\n  BroadcastChannel: _index.BroadcastChannel,\n  createLeaderElection: _index.createLeaderElection,\n  clearNodeFolder: _index.clearNodeFolder,\n  enforceOptions: _index.enforceOptions,\n  beLeader: _index.beLeader\n};","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"BroadcastChannel\", {\n  enumerable: true,\n  get: function get() {\n    return _broadcastChannel.BroadcastChannel;\n  }\n});\nObject.defineProperty(exports, \"OPEN_BROADCAST_CHANNELS\", {\n  enumerable: true,\n  get: function get() {\n    return _broadcastChannel.OPEN_BROADCAST_CHANNELS;\n  }\n});\nObject.defineProperty(exports, \"beLeader\", {\n  enumerable: true,\n  get: function get() {\n    return _leaderElection.beLeader;\n  }\n});\nObject.defineProperty(exports, \"clearNodeFolder\", {\n  enumerable: true,\n  get: function get() {\n    return _broadcastChannel.clearNodeFolder;\n  }\n});\nObject.defineProperty(exports, \"createLeaderElection\", {\n  enumerable: true,\n  get: function get() {\n    return _leaderElection.createLeaderElection;\n  }\n});\nObject.defineProperty(exports, \"enforceOptions\", {\n  enumerable: true,\n  get: function get() {\n    return _broadcastChannel.enforceOptions;\n  }\n});\nvar _broadcastChannel = require(\"./broadcast-channel.js\");\nvar _leaderElection = require(\"./leader-election.js\");","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.beLeader = beLeader;\nexports.createLeaderElection = createLeaderElection;\nvar _util = require(\"./util.js\");\nvar _unload = require(\"unload\");\nvar LeaderElection = function LeaderElection(broadcastChannel, options) {\n  var _this = this;\n  this.broadcastChannel = broadcastChannel;\n  this._options = options;\n  this.isLeader = false;\n  this.hasLeader = false;\n  this.isDead = false;\n  this.token = (0, _util.randomToken)();\n\n  /**\n   * Apply Queue,\n   * used to ensure we do not run applyOnce()\n   * in parallel.\n   */\n  this._aplQ = _util.PROMISE_RESOLVED_VOID;\n  // amount of unfinished applyOnce() calls\n  this._aplQC = 0;\n\n  // things to clean up\n  this._unl = []; // _unloads\n  this._lstns = []; // _listeners\n  this._dpL = function () {}; // onduplicate listener\n  this._dpLC = false; // true when onduplicate called\n\n  /**\n   * Even when the own instance is not applying,\n   * we still listen to messages to ensure the hasLeader flag\n   * is set correctly.\n   */\n  var hasLeaderListener = function hasLeaderListener(msg) {\n    if (msg.context === 'leader') {\n      if (msg.action === 'death') {\n        _this.hasLeader = false;\n      }\n      if (msg.action === 'tell') {\n        _this.hasLeader = true;\n      }\n    }\n  };\n  this.broadcastChannel.addEventListener('internal', hasLeaderListener);\n  this._lstns.push(hasLeaderListener);\n};\nLeaderElection.prototype = {\n  /**\n   * Returns true if the instance is leader,\n   * false if not.\n   * @async\n   */\n  applyOnce: function applyOnce(\n  // true if the applyOnce() call came from the fallbackInterval cycle\n  isFromFallbackInterval) {\n    var _this2 = this;\n    if (this.isLeader) {\n      return (0, _util.sleep)(0, true);\n    }\n    if (this.isDead) {\n      return (0, _util.sleep)(0, false);\n    }\n\n    /**\n     * Already applying more than once,\n     * -> wait for the apply queue to be finished.\n     */\n    if (this._aplQC > 1) {\n      return this._aplQ;\n    }\n\n    /**\n     * Add a new apply-run\n     */\n    var applyRun = function applyRun() {\n      /**\n       * Optimization shortcuts.\n       * Directly return if a previous run\n       * has already elected a leader.\n       */\n      if (_this2.isLeader) {\n        return _util.PROMISE_RESOLVED_TRUE;\n      }\n      var stopCriteria = false;\n      var stopCriteriaPromiseResolve;\n      /**\n       * Resolves when a stop criteria is reached.\n       * Uses as a performance shortcut so we do not\n       * have to await the responseTime when it is already clear\n       * that the election failed.\n       */\n      var stopCriteriaPromise = new Promise(function (res) {\n        stopCriteriaPromiseResolve = function stopCriteriaPromiseResolve() {\n          stopCriteria = true;\n          res();\n        };\n      });\n      var handleMessage = function handleMessage(msg) {\n        if (msg.context === 'leader' && msg.token != _this2.token) {\n          if (msg.action === 'apply') {\n            // other is applying\n            if (msg.token > _this2.token) {\n              /**\n               * other has higher token\n               * -> stop applying and let other become leader.\n               */\n              stopCriteriaPromiseResolve();\n            }\n          }\n          if (msg.action === 'tell') {\n            // other is already leader\n            stopCriteriaPromiseResolve();\n            _this2.hasLeader = true;\n          }\n        }\n      };\n      _this2.broadcastChannel.addEventListener('internal', handleMessage);\n\n      /**\n       * If the applyOnce() call came from the fallbackInterval,\n       * we can assume that the election runs in the background and\n       * not critical process is waiting for it.\n       * When this is true, we give the other instances\n       * more time to answer to messages in the election cycle.\n       * This makes it less likely to elect duplicate leaders.\n       * But also it takes longer which is not a problem because we anyway\n       * run in the background.\n       */\n      var waitForAnswerTime = isFromFallbackInterval ? _this2._options.responseTime * 4 : _this2._options.responseTime;\n      return _sendMessage(_this2, 'apply') // send out that this one is applying\n      .then(function () {\n        return Promise.race([(0, _util.sleep)(waitForAnswerTime), stopCriteriaPromise.then(function () {\n          return Promise.reject(new Error());\n        })]);\n      })\n      // send again in case another instance was just created\n      .then(function () {\n        return _sendMessage(_this2, 'apply');\n      })\n      // let others time to respond\n      .then(function () {\n        return Promise.race([(0, _util.sleep)(waitForAnswerTime), stopCriteriaPromise.then(function () {\n          return Promise.reject(new Error());\n        })]);\n      })[\"catch\"](function () {}).then(function () {\n        _this2.broadcastChannel.removeEventListener('internal', handleMessage);\n        if (!stopCriteria) {\n          // no stop criteria -> own is leader\n          return beLeader(_this2).then(function () {\n            return true;\n          });\n        } else {\n          // other is leader\n          return false;\n        }\n      });\n    };\n    this._aplQC = this._aplQC + 1;\n    this._aplQ = this._aplQ.then(function () {\n      return applyRun();\n    }).then(function () {\n      _this2._aplQC = _this2._aplQC - 1;\n    });\n    return this._aplQ.then(function () {\n      return _this2.isLeader;\n    });\n  },\n  awaitLeadership: function awaitLeadership() {\n    if ( /* _awaitLeadershipPromise */\n    !this._aLP) {\n      this._aLP = _awaitLeadershipOnce(this);\n    }\n    return this._aLP;\n  },\n  set onduplicate(fn) {\n    this._dpL = fn;\n  },\n  die: function die() {\n    var _this3 = this;\n    this._lstns.forEach(function (listener) {\n      return _this3.broadcastChannel.removeEventListener('internal', listener);\n    });\n    this._lstns = [];\n    this._unl.forEach(function (uFn) {\n      return uFn.remove();\n    });\n    this._unl = [];\n    if (this.isLeader) {\n      this.hasLeader = false;\n      this.isLeader = false;\n    }\n    this.isDead = true;\n    return _sendMessage(this, 'death');\n  }\n};\n\n/**\n * @param leaderElector {LeaderElector}\n */\nfunction _awaitLeadershipOnce(leaderElector) {\n  if (leaderElector.isLeader) {\n    return _util.PROMISE_RESOLVED_VOID;\n  }\n  return new Promise(function (res) {\n    var resolved = false;\n    function finish() {\n      if (resolved) {\n        return;\n      }\n      resolved = true;\n      leaderElector.broadcastChannel.removeEventListener('internal', whenDeathListener);\n      res(true);\n    }\n\n    // try once now\n    leaderElector.applyOnce().then(function () {\n      if (leaderElector.isLeader) {\n        finish();\n      }\n    });\n\n    /**\n     * Try on fallbackInterval\n     * @recursive\n     */\n    var tryOnFallBack = function tryOnFallBack() {\n      return (0, _util.sleep)(leaderElector._options.fallbackInterval).then(function () {\n        if (leaderElector.isDead || resolved) {\n          return;\n        }\n        if (leaderElector.isLeader) {\n          finish();\n        } else {\n          return leaderElector.applyOnce(true).then(function () {\n            if (leaderElector.isLeader) {\n              finish();\n            } else {\n              tryOnFallBack();\n            }\n          });\n        }\n      });\n    };\n    tryOnFallBack();\n\n    // try when other leader dies\n    var whenDeathListener = function whenDeathListener(msg) {\n      if (msg.context === 'leader' && msg.action === 'death') {\n        leaderElector.hasLeader = false;\n        leaderElector.applyOnce().then(function () {\n          if (leaderElector.isLeader) {\n            finish();\n          }\n        });\n      }\n    };\n    leaderElector.broadcastChannel.addEventListener('internal', whenDeathListener);\n    leaderElector._lstns.push(whenDeathListener);\n  });\n}\n\n/**\n * sends and internal message over the broadcast-channel\n */\nfunction _sendMessage(leaderElector, action) {\n  var msgJson = {\n    context: 'leader',\n    action: action,\n    token: leaderElector.token\n  };\n  return leaderElector.broadcastChannel.postInternal(msgJson);\n}\nfunction beLeader(leaderElector) {\n  leaderElector.isLeader = true;\n  leaderElector.hasLeader = true;\n  var unloadFn = (0, _unload.add)(function () {\n    return leaderElector.die();\n  });\n  leaderElector._unl.push(unloadFn);\n  var isLeaderListener = function isLeaderListener(msg) {\n    if (msg.context === 'leader' && msg.action === 'apply') {\n      _sendMessage(leaderElector, 'tell');\n    }\n    if (msg.context === 'leader' && msg.action === 'tell' && !leaderElector._dpLC) {\n      /**\n       * another instance is also leader!\n       * This can happen on rare events\n       * like when the CPU is at 100% for long time\n       * or the tabs are open very long and the browser throttles them.\n       * @link https://github.com/pubkey/broadcast-channel/issues/414\n       * @link https://github.com/pubkey/broadcast-channel/issues/385\n       */\n      leaderElector._dpLC = true;\n      leaderElector._dpL(); // message the lib user so the app can handle the problem\n      _sendMessage(leaderElector, 'tell'); // ensure other leader also knows the problem\n    }\n  };\n\n  leaderElector.broadcastChannel.addEventListener('internal', isLeaderListener);\n  leaderElector._lstns.push(isLeaderListener);\n  return _sendMessage(leaderElector, 'tell');\n}\nfunction fillOptionsWithDefaults(options, channel) {\n  if (!options) options = {};\n  options = JSON.parse(JSON.stringify(options));\n  if (!options.fallbackInterval) {\n    options.fallbackInterval = 3000;\n  }\n  if (!options.responseTime) {\n    options.responseTime = channel.method.averageResponseTime(channel.options);\n  }\n  return options;\n}\nfunction createLeaderElection(channel, options) {\n  if (channel._leaderElector) {\n    throw new Error('BroadcastChannel already has a leader-elector');\n  }\n  options = fillOptionsWithDefaults(options, channel);\n  var elector = new LeaderElection(channel, options);\n  channel._befC.push(function () {\n    return elector.die();\n  });\n  channel._leaderElector = elector;\n  return elector;\n}","\"use strict\";\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.chooseMethod = chooseMethod;\nvar _native = require(\"./methods/native.js\");\nvar _indexedDb = require(\"./methods/indexed-db.js\");\nvar _localstorage = require(\"./methods/localstorage.js\");\nvar _simulate = require(\"./methods/simulate.js\");\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n// the line below will be removed from es5/browser builds\n\n// order is important\nvar METHODS = [_native.NativeMethod,\n// fastest\n_indexedDb.IndexedDBMethod, _localstorage.LocalstorageMethod];\nfunction chooseMethod(options) {\n  var chooseMethods = [].concat(options.methods, METHODS).filter(Boolean);\n\n  // the line below will be removed from es5/browser builds\n\n  // directly chosen\n  if (options.type) {\n    if (options.type === 'simulate') {\n      // only use simulate-method if directly chosen\n      return _simulate.SimulateMethod;\n    }\n    var ret = chooseMethods.find(function (m) {\n      return m.type === options.type;\n    });\n    if (!ret) throw new Error('method-type ' + options.type + ' not found');else return ret;\n  }\n\n  /**\n   * if no webworker support is needed,\n   * remove idb from the list so that localstorage will be chosen\n   */\n  if (!options.webWorkerSupport) {\n    chooseMethods = chooseMethods.filter(function (m) {\n      return m.type !== 'idb';\n    });\n  }\n  var useMethod = chooseMethods.find(function (method) {\n    return method.canBeUsed();\n  });\n  if (!useMethod) throw new Error(\"No usable method found in \" + JSON.stringify(METHODS.map(function (m) {\n    return m.type;\n  })));else return useMethod;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TRANSACTION_SETTINGS = exports.IndexedDBMethod = void 0;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.cleanOldMessages = cleanOldMessages;\nexports.close = close;\nexports.commitIndexedDBTransaction = commitIndexedDBTransaction;\nexports.create = create;\nexports.createDatabase = createDatabase;\nexports.getAllMessages = getAllMessages;\nexports.getIdb = getIdb;\nexports.getMessagesHigherThan = getMessagesHigherThan;\nexports.getOldMessages = getOldMessages;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeMessagesById = removeMessagesById;\nexports.type = void 0;\nexports.writeMessage = writeMessage;\nvar _util = require(\"../util.js\");\nvar _obliviousSet = require(\"oblivious-set\");\nvar _options = require(\"../options.js\");\n/**\n * this method uses indexeddb to store the messages\n * There is currently no observerAPI for idb\n * @link https://github.com/w3c/IndexedDB/issues/51\n * \n * When working on this, ensure to use these performance optimizations:\n * @link https://rxdb.info/slow-indexeddb.html\n */\n\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar DB_PREFIX = 'pubkey.broadcast-channel-0-';\nvar OBJECT_STORE_ID = 'messages';\n\n/**\n * Use relaxed durability for faster performance on all transactions.\n * @link https://nolanlawson.com/2021/08/22/speeding-up-indexeddb-reads-and-writes/\n */\nvar TRANSACTION_SETTINGS = {\n  durability: 'relaxed'\n};\nexports.TRANSACTION_SETTINGS = TRANSACTION_SETTINGS;\nvar type = 'idb';\nexports.type = type;\nfunction getIdb() {\n  if (typeof indexedDB !== 'undefined') return indexedDB;\n  if (typeof window !== 'undefined') {\n    if (typeof window.mozIndexedDB !== 'undefined') return window.mozIndexedDB;\n    if (typeof window.webkitIndexedDB !== 'undefined') return window.webkitIndexedDB;\n    if (typeof window.msIndexedDB !== 'undefined') return window.msIndexedDB;\n  }\n  return false;\n}\n\n/**\n * If possible, we should explicitly commit IndexedDB transactions\n * for better performance.\n * @link https://nolanlawson.com/2021/08/22/speeding-up-indexeddb-reads-and-writes/\n */\nfunction commitIndexedDBTransaction(tx) {\n  if (tx.commit) {\n    tx.commit();\n  }\n}\nfunction createDatabase(channelName) {\n  var IndexedDB = getIdb();\n\n  // create table\n  var dbName = DB_PREFIX + channelName;\n\n  /**\n   * All IndexedDB databases are opened without version\n   * because it is a bit faster, especially on firefox\n   * @link http://nparashuram.com/IndexedDB/perf/#Open%20Database%20with%20version\n   */\n  var openRequest = IndexedDB.open(dbName);\n  openRequest.onupgradeneeded = function (ev) {\n    var db = ev.target.result;\n    db.createObjectStore(OBJECT_STORE_ID, {\n      keyPath: 'id',\n      autoIncrement: true\n    });\n  };\n  return new Promise(function (res, rej) {\n    openRequest.onerror = function (ev) {\n      return rej(ev);\n    };\n    openRequest.onsuccess = function () {\n      res(openRequest.result);\n    };\n  });\n}\n\n/**\n * writes the new message to the database\n * so other readers can find it\n */\nfunction writeMessage(db, readerUuid, messageJson) {\n  var time = new Date().getTime();\n  var writeObject = {\n    uuid: readerUuid,\n    time: time,\n    data: messageJson\n  };\n  var tx = db.transaction([OBJECT_STORE_ID], 'readwrite', TRANSACTION_SETTINGS);\n  return new Promise(function (res, rej) {\n    tx.oncomplete = function () {\n      return res();\n    };\n    tx.onerror = function (ev) {\n      return rej(ev);\n    };\n    var objectStore = tx.objectStore(OBJECT_STORE_ID);\n    objectStore.add(writeObject);\n    commitIndexedDBTransaction(tx);\n  });\n}\nfunction getAllMessages(db) {\n  var tx = db.transaction(OBJECT_STORE_ID, 'readonly', TRANSACTION_SETTINGS);\n  var objectStore = tx.objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n      if (cursor) {\n        ret.push(cursor.value);\n        //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n        cursor[\"continue\"]();\n      } else {\n        commitIndexedDBTransaction(tx);\n        res(ret);\n      }\n    };\n  });\n}\nfunction getMessagesHigherThan(db, lastCursorId) {\n  var tx = db.transaction(OBJECT_STORE_ID, 'readonly', TRANSACTION_SETTINGS);\n  var objectStore = tx.objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  var keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n\n  /**\n   * Optimization shortcut,\n   * if getAll() can be used, do not use a cursor.\n   * @link https://rxdb.info/slow-indexeddb.html\n   */\n  if (objectStore.getAll) {\n    var getAllRequest = objectStore.getAll(keyRangeValue);\n    return new Promise(function (res, rej) {\n      getAllRequest.onerror = function (err) {\n        return rej(err);\n      };\n      getAllRequest.onsuccess = function (e) {\n        res(e.target.result);\n      };\n    });\n  }\n  function openCursor() {\n    // Occasionally Safari will fail on IDBKeyRange.bound, this\n    // catches that error, having it open the cursor to the first\n    // item. When it gets data it will advance to the desired key.\n    try {\n      keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n      return objectStore.openCursor(keyRangeValue);\n    } catch (e) {\n      return objectStore.openCursor();\n    }\n  }\n  return new Promise(function (res, rej) {\n    var openCursorRequest = openCursor();\n    openCursorRequest.onerror = function (err) {\n      return rej(err);\n    };\n    openCursorRequest.onsuccess = function (ev) {\n      var cursor = ev.target.result;\n      if (cursor) {\n        if (cursor.value.id < lastCursorId + 1) {\n          cursor[\"continue\"](lastCursorId + 1);\n        } else {\n          ret.push(cursor.value);\n          cursor[\"continue\"]();\n        }\n      } else {\n        commitIndexedDBTransaction(tx);\n        res(ret);\n      }\n    };\n  });\n}\nfunction removeMessagesById(channelState, ids) {\n  if (channelState.closed) {\n    return Promise.resolve([]);\n  }\n  var tx = channelState.db.transaction(OBJECT_STORE_ID, 'readwrite', TRANSACTION_SETTINGS);\n  var objectStore = tx.objectStore(OBJECT_STORE_ID);\n  return Promise.all(ids.map(function (id) {\n    var deleteRequest = objectStore[\"delete\"](id);\n    return new Promise(function (res) {\n      deleteRequest.onsuccess = function () {\n        return res();\n      };\n    });\n  }));\n}\nfunction getOldMessages(db, ttl) {\n  var olderThen = new Date().getTime() - ttl;\n  var tx = db.transaction(OBJECT_STORE_ID, 'readonly', TRANSACTION_SETTINGS);\n  var objectStore = tx.objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n      if (cursor) {\n        var msgObk = cursor.value;\n        if (msgObk.time < olderThen) {\n          ret.push(msgObk);\n          //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n          cursor[\"continue\"]();\n        } else {\n          // no more old messages,\n          commitIndexedDBTransaction(tx);\n          res(ret);\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nfunction cleanOldMessages(channelState) {\n  return getOldMessages(channelState.db, channelState.options.idb.ttl).then(function (tooOld) {\n    return removeMessagesById(channelState, tooOld.map(function (msg) {\n      return msg.id;\n    }));\n  });\n}\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n  return createDatabase(channelName).then(function (db) {\n    var state = {\n      closed: false,\n      lastCursorId: 0,\n      channelName: channelName,\n      options: options,\n      uuid: (0, _util.randomToken)(),\n      /**\n       * emittedMessagesIds\n       * contains all messages that have been emitted before\n       * @type {ObliviousSet}\n       */\n      eMIs: new _obliviousSet.ObliviousSet(options.idb.ttl * 2),\n      // ensures we do not read messages in parallel\n      writeBlockPromise: _util.PROMISE_RESOLVED_VOID,\n      messagesCallback: null,\n      readQueuePromises: [],\n      db: db\n    };\n\n    /**\n     * Handle abrupt closes that do not originate from db.close().\n     * This could happen, for example, if the underlying storage is\n     * removed or if the user clears the database in the browser's\n     * history preferences.\n     */\n    db.onclose = function () {\n      state.closed = true;\n      if (options.idb.onclose) options.idb.onclose();\n    };\n\n    /**\n     * if service-workers are used,\n     * we have no 'storage'-event if they post a message,\n     * therefore we also have to set an interval\n     */\n    _readLoop(state);\n    return state;\n  });\n}\nfunction _readLoop(state) {\n  if (state.closed) return;\n  readNewMessages(state).then(function () {\n    return (0, _util.sleep)(state.options.idb.fallbackInterval);\n  }).then(function () {\n    return _readLoop(state);\n  });\n}\nfunction _filterMessage(msgObj, state) {\n  if (msgObj.uuid === state.uuid) return false; // send by own\n  if (state.eMIs.has(msgObj.id)) return false; // already emitted\n  if (msgObj.data.time < state.messagesCallbackTime) return false; // older then onMessageCallback\n  return true;\n}\n\n/**\n * reads all new messages from the database and emits them\n */\nfunction readNewMessages(state) {\n  // channel already closed\n  if (state.closed) return _util.PROMISE_RESOLVED_VOID;\n\n  // if no one is listening, we do not need to scan for new messages\n  if (!state.messagesCallback) return _util.PROMISE_RESOLVED_VOID;\n  return getMessagesHigherThan(state.db, state.lastCursorId).then(function (newerMessages) {\n    var useMessages = newerMessages\n    /**\n     * there is a bug in iOS where the msgObj can be undefined sometimes\n     * so we filter them out\n     * @link https://github.com/pubkey/broadcast-channel/issues/19\n     */.filter(function (msgObj) {\n      return !!msgObj;\n    }).map(function (msgObj) {\n      if (msgObj.id > state.lastCursorId) {\n        state.lastCursorId = msgObj.id;\n      }\n      return msgObj;\n    }).filter(function (msgObj) {\n      return _filterMessage(msgObj, state);\n    }).sort(function (msgObjA, msgObjB) {\n      return msgObjA.time - msgObjB.time;\n    }); // sort by time\n    useMessages.forEach(function (msgObj) {\n      if (state.messagesCallback) {\n        state.eMIs.add(msgObj.id);\n        state.messagesCallback(msgObj.data);\n      }\n    });\n    return _util.PROMISE_RESOLVED_VOID;\n  });\n}\nfunction close(channelState) {\n  channelState.closed = true;\n  channelState.db.close();\n}\nfunction postMessage(channelState, messageJson) {\n  channelState.writeBlockPromise = channelState.writeBlockPromise.then(function () {\n    return writeMessage(channelState.db, channelState.uuid, messageJson);\n  }).then(function () {\n    if ((0, _util.randomInt)(0, 10) === 0) {\n      /* await (do not await) */\n      cleanOldMessages(channelState);\n    }\n  });\n  return channelState.writeBlockPromise;\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n  readNewMessages(channelState);\n}\nfunction canBeUsed() {\n  return !!getIdb();\n}\nfunction averageResponseTime(options) {\n  return options.idb.fallbackInterval * 2;\n}\nvar IndexedDBMethod = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports.IndexedDBMethod = IndexedDBMethod;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LocalstorageMethod = void 0;\nexports.addStorageEventListener = addStorageEventListener;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports.getLocalStorage = getLocalStorage;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeStorageEventListener = removeStorageEventListener;\nexports.storageKey = storageKey;\nexports.type = void 0;\nvar _obliviousSet = require(\"oblivious-set\");\nvar _options = require(\"../options.js\");\nvar _util = require(\"../util.js\");\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside webworkers because they have no access to localstorage\n * This is basically implemented to support IE9 or your grandmother's toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\n\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nvar type = 'localstorage';\n\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\nexports.type = type;\nfunction getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {\n    // New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n  return localStorage;\n}\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    (0, _util.sleep)().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: (0, _util.randomToken)(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\nfunction addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n  window.addEventListener('storage', listener);\n  return listener;\n}\nfunction removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n  var uuid = (0, _util.randomToken)();\n\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n  var eMIs = new _obliviousSet.ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n  };\n\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n    if (msgObj.uuid === uuid) return; // own message\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nfunction close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nfunction canBeUsed() {\n  var ls = getLocalStorage();\n  if (!ls) return false;\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n  return true;\n}\nfunction averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n  return defaultTime;\n}\nvar LocalstorageMethod = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports.LocalstorageMethod = LocalstorageMethod;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NativeMethod = void 0;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.type = void 0;\nvar _util = require(\"../util.js\");\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar type = 'native';\nexports.type = type;\nfunction create(channelName) {\n  var state = {\n    messagesCallback: null,\n    bc: new BroadcastChannel(channelName),\n    subFns: [] // subscriberFunctions\n  };\n\n  state.bc.onmessage = function (msg) {\n    if (state.messagesCallback) {\n      state.messagesCallback(msg.data);\n    }\n  };\n  return state;\n}\nfunction close(channelState) {\n  channelState.bc.close();\n  channelState.subFns = [];\n}\nfunction postMessage(channelState, messageJson) {\n  try {\n    channelState.bc.postMessage(messageJson, false);\n    return _util.PROMISE_RESOLVED_VOID;\n  } catch (err) {\n    return Promise.reject(err);\n  }\n}\nfunction onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nfunction canBeUsed() {\n  if (typeof window === 'undefined') {\n    return false;\n  }\n  if (typeof BroadcastChannel === 'function') {\n    if (BroadcastChannel._pubkey) {\n      throw new Error('BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill');\n    }\n    return true;\n  } else {\n    return false;\n  }\n}\nfunction averageResponseTime() {\n  return 150;\n}\nvar NativeMethod = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports.NativeMethod = NativeMethod;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SimulateMethod = void 0;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.type = void 0;\nvar _util = require(\"../util.js\");\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar type = 'simulate';\nexports.type = type;\nvar SIMULATE_CHANNELS = new Set();\nfunction create(channelName) {\n  var state = {\n    name: channelName,\n    messagesCallback: null\n  };\n  SIMULATE_CHANNELS.add(state);\n  return state;\n}\nfunction close(channelState) {\n  SIMULATE_CHANNELS[\"delete\"](channelState);\n}\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    return setTimeout(function () {\n      var channelArray = Array.from(SIMULATE_CHANNELS);\n      channelArray.filter(function (channel) {\n        return channel.name === channelState.name;\n      }).filter(function (channel) {\n        return channel !== channelState;\n      }).filter(function (channel) {\n        return !!channel.messagesCallback;\n      }).forEach(function (channel) {\n        return channel.messagesCallback(messageJson);\n      });\n      res();\n    }, 5);\n  });\n}\nfunction onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nfunction canBeUsed() {\n  return true;\n}\nfunction averageResponseTime() {\n  return 5;\n}\nvar SimulateMethod = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports.SimulateMethod = SimulateMethod;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fillOptionsWithDefaults = fillOptionsWithDefaults;\nfunction fillOptionsWithDefaults() {\n  var originalOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var options = JSON.parse(JSON.stringify(originalOptions));\n\n  // main\n  if (typeof options.webWorkerSupport === 'undefined') options.webWorkerSupport = true;\n\n  // indexed-db\n  if (!options.idb) options.idb = {};\n  //  after this time the messages get deleted\n  if (!options.idb.ttl) options.idb.ttl = 1000 * 45;\n  if (!options.idb.fallbackInterval) options.idb.fallbackInterval = 150;\n  //  handles abrupt db onclose events.\n  if (originalOptions.idb && typeof originalOptions.idb.onclose === 'function') options.idb.onclose = originalOptions.idb.onclose;\n\n  // localstorage\n  if (!options.localstorage) options.localstorage = {};\n  if (!options.localstorage.removeTimeout) options.localstorage.removeTimeout = 1000 * 60;\n\n  // custom methods\n  if (originalOptions.methods) options.methods = originalOptions.methods;\n\n  // node\n  if (!options.node) options.node = {};\n  if (!options.node.ttl) options.node.ttl = 1000 * 60 * 2; // 2 minutes;\n  /**\n   * On linux use 'ulimit -Hn' to get the limit of open files.\n   * On ubuntu this was 4096 for me, so we use half of that as maxParallelWrites default.\n   */\n  if (!options.node.maxParallelWrites) options.node.maxParallelWrites = 2048;\n  if (typeof options.node.useFastPath === 'undefined') options.node.useFastPath = true;\n  return options;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PROMISE_RESOLVED_VOID = exports.PROMISE_RESOLVED_TRUE = exports.PROMISE_RESOLVED_FALSE = void 0;\nexports.isPromise = isPromise;\nexports.microSeconds = microSeconds;\nexports.randomInt = randomInt;\nexports.randomToken = randomToken;\nexports.sleep = sleep;\n/**\n * returns true if the given object is a promise\n */\nfunction isPromise(obj) {\n  return obj && typeof obj.then === 'function';\n}\nvar PROMISE_RESOLVED_FALSE = Promise.resolve(false);\nexports.PROMISE_RESOLVED_FALSE = PROMISE_RESOLVED_FALSE;\nvar PROMISE_RESOLVED_TRUE = Promise.resolve(true);\nexports.PROMISE_RESOLVED_TRUE = PROMISE_RESOLVED_TRUE;\nvar PROMISE_RESOLVED_VOID = Promise.resolve();\nexports.PROMISE_RESOLVED_VOID = PROMISE_RESOLVED_VOID;\nfunction sleep(time, resolveWith) {\n  if (!time) time = 0;\n  return new Promise(function (res) {\n    return setTimeout(function () {\n      return res(resolveWith);\n    }, time);\n  });\n}\nfunction randomInt(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\n/**\n * https://stackoverflow.com/a/8084248\n */\nfunction randomToken() {\n  return Math.random().toString(36).substring(2);\n}\nvar lastMs = 0;\nvar additional = 0;\n\n/**\n * returns the current time in micro-seconds,\n * WARNING: This is a pseudo-function\n * Performance.now is not reliable in webworkers, so we just make sure to never return the same time.\n * This is enough in browsers, and this function will not be used in nodejs.\n * The main reason for this hack is to ensure that BroadcastChannel behaves equal to production when it is used in fast-running unit tests.\n */\nfunction microSeconds() {\n  var ms = new Date().getTime();\n  if (ms === lastMs) {\n    additional++;\n    return ms * 1000 + additional;\n  } else {\n    lastMs = ms;\n    additional = 0;\n    return ms * 1000;\n  }\n}","/**\n * this is a set which automatically forgets\n * a given entry when a new entry is set and the ttl\n * of the old one is over\n */\nvar ObliviousSet = /** @class */ (function () {\n    function ObliviousSet(ttl) {\n        this.ttl = ttl;\n        this.map = new Map();\n        /**\n         * Creating calls to setTimeout() is expensive,\n         * so we only do that if there is not timeout already open.\n         */\n        this._to = false;\n    }\n    ObliviousSet.prototype.has = function (value) {\n        return this.map.has(value);\n    };\n    ObliviousSet.prototype.add = function (value) {\n        var _this = this;\n        this.map.set(value, now());\n        /**\n         * When a new value is added,\n         * start the cleanup at the next tick\n         * to not block the cpu for more important stuff\n         * that might happen.\n         */\n        if (!this._to) {\n            this._to = true;\n            setTimeout(function () {\n                _this._to = false;\n                removeTooOldValues(_this);\n            }, 0);\n        }\n    };\n    ObliviousSet.prototype.clear = function () {\n        this.map.clear();\n    };\n    return ObliviousSet;\n}());\nexport { ObliviousSet };\n/**\n * Removes all entries from the set\n * where the TTL has expired\n */\nexport function removeTooOldValues(obliviousSet) {\n    var olderThen = now() - obliviousSet.ttl;\n    var iterator = obliviousSet.map[Symbol.iterator]();\n    /**\n     * Because we can assume the new values are added at the bottom,\n     * we start from the top and stop as soon as we reach a non-too-old value.\n     */\n    while (true) {\n        var next = iterator.next().value;\n        if (!next) {\n            return; // no more elements\n        }\n        var value = next[0];\n        var time = next[1];\n        if (time < olderThen) {\n            obliviousSet.map.delete(value);\n        }\n        else {\n            // We reached a value that is not old enough\n            return;\n        }\n    }\n}\nexport function now() {\n    return new Date().getTime();\n}\n//# sourceMappingURL=index.js.map","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MonoChannel = exports.Channel = exports.createBroadcastChannel = exports.MessageType = void 0;\nconst broadcast_channel_1 = require(\"broadcast-channel\");\nvar MessageType;\n(function (MessageType) {\n    MessageType[\"ForceSend\"] = \"force-send\";\n    MessageType[\"Ping\"] = \"ping\";\n    MessageType[\"Pong\"] = \"pong\";\n})(MessageType = exports.MessageType || (exports.MessageType = {}));\nfunction createBroadcastChannel() {\n    return new broadcast_channel_1.BroadcastChannel('bf-sdk');\n}\nexports.createBroadcastChannel = createBroadcastChannel;\nclass Channel {\n    constructor(channel, logger) {\n        this.channel = channel;\n        this.logger = logger;\n        this.leader = false;\n        this.onForceSendCb = () => { };\n        this.sessionsStatus = {};\n        this.channel.onmessage = msg => this.handleMessage(msg);\n        this.elector = (0, broadcast_channel_1.createLeaderElection)(this.channel, {\n            fallbackInterval: 2000,\n            responseTime: 1000,\n        });\n        this.leaderPromise = this.elector.awaitLeadership();\n        this.leaderPromise.then(() => {\n            this.logger.log(`Now I'm the leader. 💪`);\n            this.leader = true;\n        });\n    }\n    setCurrentSession(session) {\n        this.session = session;\n    }\n    handleMessage(msg) {\n        var _a, _b;\n        switch (msg.type) {\n            case MessageType.ForceSend:\n                if (this.leader) {\n                    this.onForceSendCb();\n                }\n                break;\n            case MessageType.Ping:\n                if (msg.toSessionUUID === ((_a = this.session) === null || _a === void 0 ? void 0 : _a.getUUID())) {\n                    this.channel.postMessage({\n                        type: MessageType.Pong,\n                        fromSessionUUID: msg.toSessionUUID,\n                        toSessionUUID: msg.fromSessionUUID,\n                    });\n                }\n                break;\n            case MessageType.Pong:\n                if (msg.toSessionUUID === ((_b = this.session) === null || _b === void 0 ? void 0 : _b.getUUID())) {\n                    this.sessionsStatus[msg.fromSessionUUID] = true;\n                }\n                break;\n        }\n    }\n    isLeader() {\n        return this.leader;\n    }\n    notifyForceSend() {\n        if (this.leader) {\n            this.onForceSendCb();\n        }\n        else {\n            this.channel.postMessage({ type: MessageType.ForceSend });\n        }\n    }\n    onForceSend(cb) {\n        this.onForceSendCb = cb;\n    }\n    onHasBecomeLeader() {\n        return this.leaderPromise;\n    }\n    isSessionActive(sessionUUID) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const isSessionReady = !!this.session;\n            if (!isSessionReady || (isSessionReady && this.session.getUUID() === sessionUUID)) {\n                return true;\n            }\n            return new Promise(resolve => {\n                const timeout = 250;\n                this.sessionsStatus[sessionUUID] = false;\n                this.channel.postMessage({\n                    type: MessageType.Ping,\n                    fromSessionUUID: this.session.getUUID(),\n                    toSessionUUID: sessionUUID,\n                });\n                setTimeout(() => resolve(this.sessionsStatus[sessionUUID]), timeout);\n            });\n        });\n    }\n}\nexports.Channel = Channel;\nclass MonoChannel {\n    constructor() {\n        this.onForceSendCb = () => { };\n        this.leaderPromise = Promise.resolve();\n    }\n    setCurrentSession(session) {\n        this.session = session;\n    }\n    isLeader() {\n        return true;\n    }\n    isSessionActive(sessionUUID) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const isSessionReady = !!this.session;\n            return !this.session || (isSessionReady && this.session.getUUID() === sessionUUID);\n        });\n    }\n    notifyForceSend() {\n        this.onForceSendCb();\n    }\n    onForceSend(cb) {\n        this.onForceSendCb = cb;\n    }\n    onHasBecomeLeader() {\n        return this.leaderPromise;\n    }\n}\nexports.MonoChannel = MonoChannel;\n","import { addBrowser } from './browser.js';\nimport { addNode } from './node.js';\n\n/**\n * Use the code directly to prevent import problems\n * with the detect-node package.\n * @link https://github.com/iliakan/detect-node/blob/master/index.js\n */\nvar isNode = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]';\nvar USE_METHOD = isNode ? addNode : addBrowser;\nvar LISTENERS = new Set();\nvar startedListening = false;\nfunction startListening() {\n  if (startedListening) {\n    return;\n  }\n  startedListening = true;\n  USE_METHOD(runAll);\n}\nexport function add(fn) {\n  startListening();\n  if (typeof fn !== 'function') {\n    throw new Error('Listener is no function');\n  }\n  LISTENERS.add(fn);\n  var addReturn = {\n    remove: function remove() {\n      return LISTENERS[\"delete\"](fn);\n    },\n    run: function run() {\n      LISTENERS[\"delete\"](fn);\n      return fn();\n    }\n  };\n  return addReturn;\n}\nexport function runAll() {\n  var promises = [];\n  LISTENERS.forEach(function (fn) {\n    promises.push(fn());\n    LISTENERS[\"delete\"](fn);\n  });\n  return Promise.all(promises);\n}\nexport function removeAll() {\n  LISTENERS.clear();\n}\nexport function getSize() {\n  return LISTENERS.size;\n}","export function addNode(fn) {\n  process.on('exit', function () {\n    return fn();\n  });\n\n  /**\n   * on the following events,\n   * the process will not end if there are\n   * event-handlers attached,\n   * therefore we have to call process.exit()\n   */\n  process.on('beforeExit', function () {\n    return fn().then(function () {\n      return process.exit();\n    });\n  });\n  // catches ctrl+c event\n  process.on('SIGINT', function () {\n    return fn().then(function () {\n      return process.exit();\n    });\n  });\n  // catches uncaught exceptions\n  process.on('uncaughtException', function (err) {\n    return fn().then(function () {\n      console.trace(err);\n      process.exit(101);\n    });\n  });\n}","/* global WorkerGlobalScope */\n\nexport function addBrowser(fn) {\n  if (typeof WorkerGlobalScope === 'function' && self instanceof WorkerGlobalScope) {\n    /**\n     * Because killing a worker does directly stop the excution\n     * of the code, our only chance is to overwrite the close function\n     * which could work some times.\n     * @link https://stackoverflow.com/q/72903255/3443137\n     */\n    var oldClose = self.close.bind(self);\n    self.close = function () {\n      fn();\n      return oldClose();\n    };\n  } else {\n    /**\n     * if we are on react-native, there is no window.addEventListener\n     * @link https://github.com/pubkey/unload/issues/6\n     */\n    if (typeof window.addEventListener !== 'function') {\n      return;\n    }\n\n    /**\n     * for normal browser-windows, we use the beforeunload-event\n     */\n    window.addEventListener('beforeunload', function () {\n      fn();\n    }, true);\n\n    /**\n     * for iframes, we have to use the unload-event\n     * @link https://stackoverflow.com/q/47533670/3443137\n     */\n    window.addEventListener('unload', function () {\n      fn();\n    }, true);\n  }\n\n  /**\n   * TODO add fallback for safari-mobile\n   * @link https://stackoverflow.com/a/26193516/3443137\n   */\n}","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return (module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports), _typeof(obj);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(6110);\n"],"names":["root","factory","exports","module","define","amd","self","Object","defineProperty","value","OPEN_BROADCAST_CHANNELS","BroadcastChannel","clearNodeFolder","options","_options","fillOptionsWithDefaults","method","_methodChooser","chooseMethod","type","then","_util","PROMISE_RESOLVED_FALSE","enforceOptions","ENFORCED_OPTIONS","Set","lastId","name","channel","maybePromise","this","id","add","_iL","_onML","_addEL","message","internal","_uMP","_befC","_prepP","create","isPromise","s","_state","_post","broadcastChannel","msg","msgObj","time","microSeconds","data","PROMISE_RESOLVED_VOID","sendPromise","postMessage","_hasMessageListeners","length","_addListenerObject","obj","push","listenerFn","forEach","listenerObject","minMessageTime","fn","onMessage","_startListening","_removeListenerObject","filter","o","_stopListening","_pubkey","prototype","closed","Error","JSON","stringify","postInternal","onmessage","listenObj","addEventListener","removeEventListener","find","close","_this","awaitPrepare","Promise","all","Array","from","map","isClosed","_index","createLeaderElection","beLeader","enumerable","get","_broadcastChannel","_leaderElection","_leaderElector","parse","fallbackInterval","responseTime","averageResponseTime","elector","LeaderElection","die","_unload","isLeader","hasLeader","isDead","token","randomToken","_aplQ","_aplQC","_unl","_lstns","_dpL","_dpLC","hasLeaderListener","context","action","_sendMessage","leaderElector","msgJson","unloadFn","isLeaderListener","applyOnce","isFromFallbackInterval","_this2","sleep","PROMISE_RESOLVED_TRUE","stopCriteriaPromiseResolve","stopCriteria","stopCriteriaPromise","res","handleMessage","waitForAnswerTime","race","reject","applyRun","awaitLeadership","_aLP","resolved","finish","whenDeathListener","tryOnFallBack","onduplicate","_this3","listener","uFn","remove","chooseMethods","concat","methods","METHODS","Boolean","_simulate","SimulateMethod","ret","m","webWorkerSupport","useMethod","canBeUsed","_native","_indexedDb","_localstorage","NativeMethod","IndexedDBMethod","LocalstorageMethod","TRANSACTION_SETTINGS","cleanOldMessages","commitIndexedDBTransaction","createDatabase","getAllMessages","db","tx","transaction","OBJECT_STORE_ID","objectStore","openCursor","onsuccess","ev","cursor","target","result","getIdb","getMessagesHigherThan","getOldMessages","removeMessagesById","writeMessage","_obliviousSet","durability","indexedDB","window","mozIndexedDB","webkitIndexedDB","msIndexedDB","commit","channelName","dbName","openRequest","open","onupgradeneeded","createObjectStore","keyPath","autoIncrement","rej","onerror","readerUuid","messageJson","writeObject","uuid","Date","getTime","oncomplete","lastCursorId","keyRangeValue","IDBKeyRange","bound","Infinity","getAll","getAllRequest","err","e","openCursorRequest","channelState","ids","resolve","deleteRequest","ttl","olderThen","msgObk","idb","tooOld","state","eMIs","ObliviousSet","writeBlockPromise","messagesCallback","readQueuePromises","onclose","_readLoop","readNewMessages","newerMessages","useMessages","has","messagesCallbackTime","_filterMessage","sort","msgObjA","msgObjB","randomInt","addStorageEventListener","getLocalStorage","removeStorageEventListener","storageKey","localStorage","key","writeObj","setItem","document","createEvent","initEvent","newValue","dispatchEvent","localstorage","removeTimeout","ls","removeItem","userAgent","navigator","toLowerCase","includes","defaultTime","bc","subFns","SIMULATE_CHANNELS","setTimeout","originalOptions","arguments","undefined","node","maxParallelWrites","useFastPath","ms","lastMs","additional","min","max","Math","floor","random","toString","substring","resolveWith","Map","_to","set","now","removeTooOldValues","clear","obliviousSet","iterator","Symbol","next","delete","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","defaultClearTimeout","runTimeout","fun","call","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","args","i","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","rejected","done","MonoChannel","Channel","createBroadcastChannel","MessageType","broadcast_channel_1","constructor","logger","leader","onForceSendCb","sessionsStatus","leaderPromise","log","setCurrentSession","session","_a","_b","ForceSend","Ping","toSessionUUID","getUUID","Pong","fromSessionUUID","notifyForceSend","onForceSend","cb","onHasBecomeLeader","isSessionActive","sessionUUID","isSessionReady","USE_METHOD","exit","console","trace","WorkerGlobalScope","oldClose","bind","LISTENERS","startedListening","runAll","promises","removeAll","getSize","size","_typeof","__esModule","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","d","definition","prop","hasOwnProperty","r","toStringTag"],"sourceRoot":""}