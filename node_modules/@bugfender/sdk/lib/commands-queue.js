/*! For license information please see commands-queue.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["@bugfender/sdk"]=t():e["@bugfender/sdk"]=t()}(self,(()=>(()=>{"use strict";var e={5049:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CommandType=void 0,(r=t.CommandType||(t.CommandType={})).AddIssue="add-issue",r.AddLogEntry="add-log-entry",r.AddLogMessage="add-log-message",r.ForceSendOnce="force-send-once",r.SetDeviceKey="set-device-key"},8593:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getElByXPath=t.getXPath=t.DebounceByElement=t.UnreachableCaseError=t.CacheDecoratorFactory=t.createDeferred=void 0,t.createDeferred=function(){const e={isFulfilled:!1,isRejected:!1,isResolved:!1};return e.promise=new Promise(((t,r)=>{e.resolve=r=>{const s=e;s.isFulfilled=!0,s.isRejected=!1,s.isResolved=!0,s.value=r,t(r)},e.reject=t=>{const s=e;s.isFulfilled=!0,s.isRejected=!0,s.isResolved=!1,s.err=t,r(t)}})),e},t.CacheDecoratorFactory=function(e){return function(){return function(t,r,s){const o=s.value;s.value=function(){return e.has(r)||e.set(r,o.apply(this)),e.get(r)}}}};class r extends Error{constructor(e){super(`Unreachable case: ${JSON.stringify(e)}`)}}t.UnreachableCaseError=r,t.DebounceByElement=class{constructor(e){this.wait=e,this.timers=new Map}run(e,t){this.timers.has(e)&&clearTimeout(this.timers.get(e)),this.timers.set(e,setTimeout((()=>{t(),this.timers.delete(e)}),this.wait))}},t.getXPath=function(e){let t=e;if(t instanceof Element&&t.id)return'//*[@id="'+t.id+'"]';const r=[];for(;t&&t instanceof Element;){const e=t;let s=0,o=!1,a=e.previousSibling;for(;a;)a.nodeType!==Node.DOCUMENT_TYPE_NODE&&a.nodeName===e.nodeName&&s++,a=a.previousSibling;for(a=e.nextSibling;a;){if(a.nodeName===e.nodeName){o=!0;break}a=a.nextSibling}const d=e.prefix?e.prefix+":":"",i=s||o?`[${s+1}]`:"";r.push(d+e.localName+i),t=e.parentNode}return r.length?"/"+r.reverse().join("/"):""},t.getElByXPath=function(e){var t;return null!==(t=document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)&&void 0!==t?t:void 0}}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,r),a.exports}var s={};return(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.CommandsQueue=void 0;const t=r(5049),o=r(8593);e.CommandsQueue=class{constructor(e,t,r){this.callInfoFactory=e,this.timer=t,this.uuidFactory=r,this.queue=[],this.storageDeferred=(0,o.createDeferred)()}init(e){this.storageDeferred.resolve(e),this.queue.forEach((e=>{this.handleCommand(e)}))}handleCommand(e){if(this.storageDeferred.isResolved)switch(e.type){case t.CommandType.AddIssue:this.storageDeferred.value.addIssue(e);break;case t.CommandType.AddLogEntry:this.storageDeferred.value.addLogEntry(e);break;case t.CommandType.AddLogMessage:this.storageDeferred.value.addLogMessage(e);break;case t.CommandType.ForceSendOnce:this.storageDeferred.value.forceSendOnce();break;case t.CommandType.SetDeviceKey:this.storageDeferred.value.addDeviceKey(e);break;default:throw new o.UnreachableCaseError(e)}}add(e){this.storageDeferred.isFulfilled?this.handleCommand(e):this.queue.push(e)}addIssue(e,r,s){const a=(0,o.createDeferred)();return this.add({type:t.CommandType.AddIssue,issueType:e,title:r,text:s,uuid:this.uuidFactory.create(),callInfo:this.callInfoFactory.create(),url:a,time:this.timer.getTime()}),a.promise}addLogEntry(e){this.add({type:t.CommandType.AddLogEntry,log:e,callInfo:this.callInfoFactory.create(),time:this.timer.getTime()})}addLogMessage(e,r){this.add({type:t.CommandType.AddLogMessage,level:e,parameters:r,callInfo:this.callInfoFactory.create(),time:this.timer.getTime()})}forceSendOnce(){this.add({type:t.CommandType.ForceSendOnce})}setDeviceKey(e,r){this.add({type:t.CommandType.SetDeviceKey,key:e,value:r,callInfo:this.callInfoFactory.create(),time:this.timer.getTime()})}}})(),s})()));
//# sourceMappingURL=commands-queue.js.map